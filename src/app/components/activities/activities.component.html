@for (activity of activities; track activity) {
  <div
      class="activity"
      (click)="activityClick(activity, $event)">
    <div class="header">
      <fs-activity-object-type
        [color]="activity.activityObjectType.color"
        [icon]="activity.activityObjectType.icon">
      </fs-activity-object-type>
      <div>
        <div class="header-description">
          <span class="object-type-name">
            {{ activity.activityType.name }}
          </span>
          <span class="header-creator small">
            &middot;
            @if (activity.creatorObject) {
              @if (activity.creatorObject.imageUrl) {
                <fs-badge
                  [size]="19"
                  [image]="activity.creatorObject.imageUrl">
                </fs-badge>
              }
              {{ activity.creatorObject.name }}
            &middot;
            }
            <fs-date-ago [date]="activity.createDate"></fs-date-ago>
          </span>
        </div>
      </div>
      <app-activity-menu
        [activity]="activity"
        [actions]="config.actions"
        [showDeleteAction]="config.showDeleteAction"
        (activityDelete)="activityDelete($event)">
      </app-activity-menu>
    </div>
    <div class="content">
      @if (activity.action === ActivityAction.ChangeData) {
        @if (this.activityPreviews[activity.activityType.type]?.showPrevious) {
          <ng-container
            [ngTemplateOutlet]="previousDataPreview"
            [ngTemplateOutletContext]="{ activity: activity }">
          </ng-container>
          <mat-icon class="previous-arrow">
            east
          </mat-icon>
        }
        <ng-container
          [ngTemplateOutlet]="dataPreview"
          [ngTemplateOutletContext]="{ activity: activity }">
        </ng-container>
      } @else if (activity.action === ActivityAction.ChangeObject) {
        @if (this.activityPreviews[activity.activityType.type]?.showPrevious) {
          <ng-container
            [ngTemplateOutlet]="previousObjectPreview"
            [ngTemplateOutletContext]="{ activity: activity }">
          </ng-container>
          <mat-icon class="previous-arrow">
            east
          </mat-icon>
        }
        <ng-container
          [ngTemplateOutlet]="objectPreview"
          [ngTemplateOutletContext]="{ activity: activity }">
        </ng-container>
      } @else if (activity.action === ActivityAction.AddObject) {
        <ng-container
          [ngTemplateOutlet]="objectPreview"
          [ngTemplateOutletContext]="{ activity: activity }">
        </ng-container>
      }
    </div>
  </div>
}
<ng-template
    #objectPreview
    let-activity="activity">
  @if (this.activityPreviews[activity.activityType.type]) {
    <ng-container
      [ngTemplateOutlet]="this.activityPreviews[activity.activityType.type].templateRef"
      [ngTemplateOutletContext]="{ activity: activity, data: activity.concreteActivityObject }">
    </ng-container>
  } @else {
    {{ activity.concreteActivityObject?.name || 'None' }}
  }
</ng-template>
<ng-template
    #dataPreview
    let-activity="activity">
  @if (this.activityPreviews[activity.activityType.type]) {
    <ng-container
      [ngTemplateOutlet]="this.activityPreviews[activity.activityType.type].templateRef"
      [ngTemplateOutletContext]="{ activity: activity, data: activity.activityData }">
    </ng-container>
  } @else {
    {{ activity.activityData || 'None' }}
  }
</ng-template>
<ng-template
    #previousObjectPreview
    let-activity="activity">
  @if (this.activityPreviews[activity.activityType.type]) {
    <ng-container
      [ngTemplateOutlet]="this.activityPreviews[activity.activityType.type].templateRef"
      [ngTemplateOutletContext]="{ activity: activity, data: activity.concretePreviousActivityObject }">
    </ng-container>
  } @else {
    {{ activity.concretePreviousActivityObject?.name || 'None' }}
  }
</ng-template>
<ng-template
    #previousDataPreview
    let-activity="activity">
  @if (this.activityPreviews[activity.activityType.type]) {
    <ng-container
      [ngTemplateOutlet]="this.activityPreviews[activity.activityType.type].templateRef"
      [ngTemplateOutletContext]="{ activity: activity, data: activity.previousActivityData }">
    </ng-container>
  } @else {
    {{ activity.previousActivityData || 'None' }}
  }
</ng-template>